<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>kdiseprimo</title>

  <!-- Título: Asset -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Asset&display=swap" rel="stylesheet">

  <!-- Texto general -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --card: rgba(18,18,18,.62);
      --border: rgba(255,255,255,.10);
      --border2: rgba(255,255,255,.16);
      --text: #ffffff;
      --muted2: rgba(255,255,255,.62);
    }

    /* ✅ Fondo robusto en móvil: lo pintamos con un pseudo-elemento fijo */
    html, body { height: 100%; }
    body{
      margin:0;
      color:var(--text);
      font-family:"Space Grotesk", system-ui, Arial;
      overflow-x:hidden;
      background:#0b0b0b;
      position:relative;
      min-height:100vh;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      background:
        linear-gradient(rgba(11,11,11,.55), rgba(11,11,11,.65)),
        url("bg.png");
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      transform: translateZ(0);
      will-change: transform;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:22px;
      overflow-x:hidden;
      box-sizing:border-box;
    }
    a{color:#fff}

    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      margin:12px 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-sizing:border-box;
    }

    .grid{
      display:grid;
      gap:12px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border:1px solid var(--border);
      border-radius:12px;
      text-decoration:none;
      margin:6px 8px 0 0;
      cursor:pointer;
      background: rgba(255,255,255,.06);
      color:#fff;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
      box-sizing:border-box;
      max-width:100%;
    }
    .btn:hover{background: rgba(255,255,255,.10); border-color: var(--border2)}
    .btn:active{transform: translateY(1px)}

    /* ✅ Título más pequeño y sin cortes */
    h1{
      margin:0 0 6px;
      letter-spacing:.3px;
      font-family:"Asset", system-ui, Arial;
      font-size: 34px;           /* base */
      line-height: 1.05;
      text-transform: lowercase;
      white-space: normal;
      overflow-wrap: anywhere;
      word-break: break-word;
      max-width: 100%;
    }
    /* En pantallas mayores, un poco más grande */
    @media (min-width: 480px){
      h1{ font-size: 44px; }
    }

    .subhead{opacity:.85;margin:0 0 14px 0}
    h2{margin:8px 0 10px}
    small{opacity:.85}

    .highlight{
      background: rgba(255,255,255,.06);
      border:2px solid rgba(255,255,255,.75);
      border-radius:18px;
      padding:18px;
      margin:16px 0 12px 0;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-sizing:border-box;
    }
    .highlight h2{margin:0 0 10px 0}
    .highlight .big{font-size:22px;font-weight:800;margin:0 0 6px 0}
    .highlight .sub{opacity:.9;margin:0}

    .iconRow{display:flex;gap:10px;flex-wrap:wrap}
    .iconBtn{
      width:44px;height:44px;
      display:inline-flex;align-items:center;justify-content:center;
      border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      box-sizing:border-box;
    }
    .iconBtn:hover{background: rgba(255,255,255,.10); border-color: var(--border2)}
    .iconBtn:active{transform: translateY(1px)}
    .iconBtn svg{width:22px;height:22px;fill:#fff !important;opacity:.95}
    .iconBtn svg path{fill:#fff !important}

    .songTitle{margin:0 0 10px 0;font-weight:800}

    .songRow{display:flex;gap:12px;align-items:center;margin-bottom:10px}
    .cover{
      width:58px;height:58px;border-radius:14px;object-fit:cover;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
    }
    .songInfo{min-width:0}
    .songInfo .songTitle{margin:0 0 4px 0}
    .songInfo .songSub{margin:0;color:var(--muted2);font-size:14px}

    canvas#game{
      background: rgba(10,10,10,.75);
      border:1px solid var(--border);
      border-radius:18px;
      width:100%;
      height:auto;
      touch-action:none;
      display:block;
      max-width:100%;
    }

    /* ✅ En móvil, más padding y sin “cosas raras” */
    @media (max-width: 420px){
  .wrap{ padding:18px; }
  .highlight .big{ font-size:20px; }
  h1{ font-size: 28px; } /* ← más pequeño en móvil */
}

  </style>
</head>

<body>
  <div class="wrap">
    <h1>kdiseprimo</h1>
    <p class="subhead">Próximo lanzamiento · Minijuego · Links · Último lanzamiento · Canciones populares · Contacto</p>

    <div class="highlight">
      <h2>Próximo lanzamiento</h2>
      <p class="big">"Un gitano en Madrid"</p>
      <p class="sub">Fecha por confirmar</p>
    </div>

    <div class="card">
      <h2>Minijuego</h2>
      <p style="margin:0 0 10px 0;opacity:.85">Intenta entrar al top esquivando los bloques</p>

      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:10px">
        <button class="btn" id="startBtn">Empezar</button>
        <div style="opacity:.9"><strong>Puntos:</strong> <span id="score">0</span></div>
        <div style="opacity:.9"><strong>Record personal:</strong> <span id="topInline">—</span></div>
      </div>

      <canvas id="game" width="900" height="520"></canvas>

      <div class="card" style="margin:12px 0 0">
        <strong>Podio actual</strong>
        <ol id="topList" style="margin:8px 0 0 18px;padding:0"></ol>
      </div>
    </div>

    <div class="card">
      <h2>Links</h2>
      <div class="iconRow">
        <a class="iconBtn" href="https://open.spotify.com/intl-es/artist/4Q2DU497iIFBFopL3EOk0R?si=vV76UVhKTQSD8-_0R8F7VA" target="_blank" rel="noopener" aria-label="Spotify">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 0C5.372 0 0 5.373 0 12c0 6.628 5.372 12 12 12s12-5.372 12-12C24 5.373 18.628 0 12 0zm5.489 17.318a.747.747 0 0 1-1.028.246c-2.816-1.72-6.36-2.11-10.534-1.159a.75.75 0 0 1-.334-1.462c4.57-1.043 8.49-.59 11.65 1.34a.75.75 0 0 1 .246 1.035zm1.471-3.27a.934.934 0 0 1-1.286.308c-3.222-1.98-8.135-2.554-11.947-1.397a.935.935 0 0 1-.543-1.789c4.356-1.322 9.769-.681 13.46 1.59a.934.934 0 0 1 .316 1.288zm.126-3.39c-3.862-2.294-10.237-2.506-13.924-1.387a1.12 1.12 0 0 1-.65-2.144c4.237-1.286 11.278-1.037 15.735 1.61a1.12 1.12 0 0 1-1.161 1.921z"/>
          </svg>
        </a>

        <a class="iconBtn" href="https://youtube.com/channel/UC5CHMp3u4PjXeLBRovIYnUQ?si=ofgjeWpJKWaw-Lyy" target="_blank" rel="noopener" aria-label="YouTube">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21.6 7.2a3 3 0 0 0-2.1-2.12C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.48A3 3 0 0 0 2.4 7.2 31.3 31.3 0 0 0 2 12a31.3 31.3 0 0 0 .4 4.8 3 3 0 0 0 2.1 2.12c1.8.48 7.5.48 7.5.48s5.7 0 7.5-.48a3 3 0 0 0 2.1-2.12A31.3 31.3 0 0 0 22 12a31.3 31.3 0 0 0-.4-4.8ZM10.2 15.2V8.8L15.7 12l-5.5 3.2Z"/>
          </svg>
        </a>

        <a class="iconBtn" href="https://www.tiktok.com/@kdiseprimo_?is_from_webapp=1&sender_device=pc" target="_blank" rel="noopener" aria-label="TikTok">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M16.7 3c.4 3 2.5 4.8 5.3 5v3.2c-2 0-3.8-.6-5.3-1.7V16c0 4-3.2 7-7.1 7-3.8 0-6.9-3-6.9-6.9 0-3.9 3-7 6.9-7 .4 0 .7 0 1.1.1v3.4c-.4-.1-.7-.2-1.1-.2-2.1 0-3.7 1.7-3.7 3.8 0 2.1 1.7 3.8 3.7 3.8 2.2 0 3.9-1.8 3.9-4V3h3.2Z"/>
          </svg>
        </a>

        <a class="iconBtn" href="https://www.instagram.com/kdiseprimo_/" target="_blank" rel="noopener" aria-label="Instagram">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M7.2 2h9.6A5.2 5.2 0 0 1 22 7.2v9.6A5.2 5.2 0 0 1 16.8 22H7.2A5.2 5.2 0 0 1 2 16.8V7.2A5.2 5.2 0 0 1 7.2 2Zm9.6 2H7.2A3.2 3.2 0 0 0 4 7.2v9.6A3.2 3.2 0 0 0 7.2 20h9.6A3.2 3.2 0 0 0 20 16.8V7.2A3.2 3.2 0 0 0 16.8 4ZM12 7.2A4.8 4.8 0 1 1 7.2 12 4.8 4.8 0 0 1 12 7.2Zm0 2A2.8 2.8 0 1 0 14.8 12 2.8 2.8 0 0 0 12 9.2Zm5.7-.9a1.1 1.1 0 1 1-1.1-1.1 1.1 1.1 0 0 1 1.1 1.1Z"/>
          </svg>
        </a>
      </div>
      <p style="margin:10px 0 0;color:var(--muted2);font-size:14px">No te pierdas nada</p>
    </div>

    <div class="card">
      <h2>Último lanzamiento</h2>
      <div class="songRow">
        <img class="cover" src="covers/consobrina.png" alt="Portada Consobrina mea Mora">
        <div class="songInfo">
          <p class="songTitle">Consobrina mea Mora</p>
          <p class="songSub">Single</p>
        </div>
      </div>
      <a class="btn" href="https://open.spotify.com/intl-es/track/1yjI7qjl7xAUYVzFQjq9wK?si=1d8d718541ed4fb3" target="_blank" rel="noopener">Escuchar aquí</a>
    </div>

    <div class="card">
      <h2>Canciones populares</h2>
      <div class="grid">
        <div class="card" style="margin:0">
          <div class="songRow">
            <img class="cover" src="covers/consobrina.png" alt="Portada Consobrina mea Mora">
            <div class="songInfo">
              <p class="songTitle">Consobrina mea Mora</p>
              <p class="songSub">Spotify</p>
            </div>
          </div>
          <a class="btn" href="https://open.spotify.com/intl-es/track/1yjI7qjl7xAUYVzFQjq9wK?si=cb9ae0dab4d7402f" target="_blank" rel="noopener">Escuchar aquí</a>
        </div>

        <div class="card" style="margin:0">
          <div class="songRow">
            <img class="cover" src="covers/pipa.png" alt="Portada pasame la pipa">
            <div class="songInfo">
              <p class="songTitle">pasame la pipa</p>
              <p class="songSub">Spotify</p>
            </div>
          </div>
          <a class="btn" href="https://open.spotify.com/intl-es/track/5Vy8VlQgm0Qja8hEh2AkBK?si=57d9b8f011df4fbf" target="_blank" rel="noopener">Escuchar aquí</a>
        </div>

        <div class="card" style="margin:0">
          <div class="songRow">
            <img class="cover" src="covers/pobreza.png" alt="Portada Puta pobreza">
            <div class="songInfo">
              <p class="songTitle">Puta pobreza</p>
              <p class="songSub">Spotify</p>
            </div>
          </div>
          <a class="btn" href="https://open.spotify.com/intl-es/track/2q6qbrJbF8oLcwfIA3ccol?si=428cc4c907d647c0" target="_blank" rel="noopener">Escuchar aquí</a>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>Contacto</h2>
      <p style="margin:0;color:var(--muted2)">Instagram mensaje directo: <strong>@kdiseprimo_</strong></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
  (() => {
    const SUPABASE_URL = "https://lxihqazprzbtyrkejxnd.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_lPKGGeuyQlb3CuRaHzuB1g_Rzrhenk4";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const startBtn = document.getElementById("startBtn");
    const scoreEl = document.getElementById("score");
    const topInline = document.getElementById("topInline");
    const topList = document.getElementById("topList");

    const W = canvas.width, H = canvas.height;

    let running = false;
    let t = 0;
    let last = 0;
    let score = 0;

    const player = { w:44, h:44, x:W/2-22, y:H-70, vx:0 };
    let obstacles = [];
    let spawnTimer = 0;
    let speed = 220;

    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    function renderTop(arr){
      topList.innerHTML = "";
      arr.slice(0,3).forEach(s=>{
        const li = document.createElement("li");
        li.textContent = `${s.name} — ${s.score}`;
        topList.appendChild(li);
      });
      topInline.textContent = arr.length ? `${arr[0].name} ${arr[0].score}` : "—";
    }

    function cleanName(name){
      name = (name || "anon").trim();
      name = name.replace(/\s+/g, " ").slice(0, 12);
      if (!name) name = "anon";
      return name;
    }

    async function loadGlobalTop(){
      const { data, error } = await sb
        .from("scores")
        .select("name, score, created_at")
        .order("score", { ascending: false })
        .order("created_at", { ascending: true })
        .limit(3);

      if (error) {
        console.error("Supabase load error:", error);
        renderTop([]);
        return [];
      }

      renderTop(data || []);
      return data || [];
    }

    async function saveGlobalScore(name, sc){
      name = cleanName(name);

      const { error } = await sb
        .from("scores")
        .insert({ name, score: sc });

      if (error) {
        console.error("Supabase insert error:", error);
        return;
      }

      await loadGlobalTop();
    }

    function reset(){
      player.x = W/2-player.w/2;
      player.vx = 0;
      obstacles = [];
      spawnTimer = 0;
      speed = 220;
      score = 0;
      t = 0;
      scoreEl.textContent = "0";
    }

    function start(){
      reset();
      running = true;
      last = performance.now();
      requestAnimationFrame(loop);
    }

    function gameOver(){
      running = false;
      const name = prompt("Tu nombre (máx 12 letras):") || "anon";
      saveGlobalScore(name, score);
    }

    function spawn(){
      const size = 26 + Math.random()*26;
      const x = Math.random()*(W-size);
      obstacles.push({x, y:-size, w:size, h:size, vy: speed*(0.7+Math.random()*0.6)});
    }

    function hit(a,b){
      return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
    }

    function update(dt){
      t += dt;
      speed = 220 + t*18;
      const spawnEvery = Math.max(0.20, 0.70 - t*0.02);

      spawnTimer += dt;
      while(spawnTimer > spawnEvery){
        spawnTimer -= spawnEvery;
        spawn();
        if (t > 10 && Math.random() < 0.35) spawn();
      }

      player.x += player.vx*dt;
      player.x = clamp(player.x, 0, W-player.w);

      obstacles.forEach(o=>o.y += o.vy*dt);
      obstacles = obstacles.filter(o=>o.y < H+60);

      for(const o of obstacles){
        if(hit(player,o)) return gameOver();
      }

      score = Math.floor(t*10);
      scoreEl.textContent = score;
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      ctx.fillStyle = "#0f0f0f";
      ctx.fillRect(0,H-40,W,40);

      ctx.fillStyle = "#ffffff";
      ctx.fillRect(player.x, player.y, player.w, player.h);

      ctx.fillStyle = "#cfcfcf";
      obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));
    }

    function loop(now){
      if(!running) return;
      const dt = Math.min(0.033, (now-last)/1000);
      last = now;
      update(dt);
      draw();
      requestAnimationFrame(loop);
    }

    window.addEventListener("keydown", (e)=>{
      if(e.key==="ArrowLeft") player.vx = -420;
      if(e.key==="ArrowRight") player.vx = 420;
    });
    window.addEventListener("keyup", (e)=>{
      if(e.key==="ArrowLeft" || e.key==="ArrowRight") player.vx = 0;
    });

    let dragging=false;
    canvas.addEventListener("pointerdown", ()=>{dragging=true;});
    canvas.addEventListener("pointerup", ()=>{dragging=false; player.vx=0;});
    canvas.addEventListener("pointermove", (e)=>{
      if(!dragging) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX-rect.left) * (canvas.width/rect.width);
      player.x = clamp(x-player.w/2, 0, W-player.w);
    });

    startBtn.addEventListener("click", start);

    loadGlobalTop();
  })();
  </script>
</body>
</html>
